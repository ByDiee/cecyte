<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Horario</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAH6MvrHYih49lF9RY1mdi0L3JK9HFyIP0",
            authDomain: "pdlista-61c4d.firebaseapp.com",
            projectId: "pdlista-61c4d",
            storageBucket: "pdlista-61c4d.appspot.com",
            messagingSenderId: "449596760167",
            appId: "1:449596760167:web:dd667445d003c22f47f4c2",
            measurementId: "G-BDXFNR25C0",
            databaseURL: "https://pdlista-61c4d-default-rtdb.firebaseio.com/"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function cargarSemestreYGrupo() {
            const semestreSelect = document.getElementById("semestre");
            const grupoSelect = document.getElementById("grupo");

            // Obtener los semestres y grupos de Firebase
            db.ref('classSchedules').once('value', snapshot => {
                const data = snapshot.val();
                semestreSelect.innerHTML = "";
                grupoSelect.innerHTML = "";

                // Llenar semestres
                Object.keys(data).forEach(semestre => {
                    const option = document.createElement("option");
                    option.value = semestre;
                    option.textContent = "Semestre " + semestre.replace('semester', '');
                    semestreSelect.appendChild(option);
                });

                // Llenar grupos dependiendo del semestre
                semestreSelect.addEventListener('change', function() {
                    grupoSelect.innerHTML = "";
                    const selectedSemestre = this.value;

                    Object.keys(data[selectedSemestre]).forEach(grupo => {
                        const option = document.createElement("option");
                        option.value = grupo;
                        option.textContent = "Grupo " + grupo.replace('group', '');
                        grupoSelect.appendChild(option);
                    });
                });
            });
        }

        function cargarMateriasDisponibles() {
            const semestre = document.getElementById("semestre").value;
            const grupo = document.getElementById("grupo").value;
            const dia = document.getElementById("dia").value;
            const hora = document.getElementById("hora").value;

            if (semestre && grupo && dia && hora) {
                db.ref(`classSchedules/${semestre}/${grupo}/${dia}/${hora}`).once('value', snapshot => {
                    const materia = snapshot.val();
                    const materiaSelect = document.getElementById("materia");
                    materiaSelect.innerHTML = "";

                    if (materia) {
                        const option = document.createElement("option");
                        option.value = materia;
                        option.textContent = materia;
                        materiaSelect.appendChild(option);
                    } else {
                        const option = document.createElement("option");
                        option.value = "";
                        option.textContent = "No hay materias disponibles";
                        materiaSelect.appendChild(option);
                    }
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            cargarSemestreYGrupo();

            document.getElementById("hora").addEventListener("change", cargarMateriasDisponibles);
            document.getElementById("semestre").addEventListener("change", cargarMateriasDisponibles);
            document.getElementById("grupo").addEventListener("change", cargarMateriasDisponibles);
            document.getElementById("dia").addEventListener("change", cargarMateriasDisponibles);
        });
    </script>
</head>
<body>
    <h1>Editar Horario del Maestro</h1>
    <form>
        <label for="semestre">Semestre:</label>
        <select id="semestre" required>
            <!-- Se llenará dinámicamente -->
        </select>
        <br>
        
        <label for="grupo">Grupo:</label>
        <select id="grupo" required>
            <!-- Se llenará dinámicamente -->
        </select>
        <br>

        <label for="dia">Día:</label>
        <select id="dia" required>
            <option value="Lunes">Lunes</option>
            <option value="Martes">Martes</option>
            <option value="Miercoles">Miércoles</option>
            <option value="Jueves">Jueves</option>
            <option value="Viernes">Viernes</option>
        </select>
        <br>

        <label for="hora">Hora (módulo):</label>
        <select id="hora" required>
            <option value="0700">7:00</option>
            <option value="0745">7:45</option>
            <option value="0830">8:30</option>
            <option value="0915">9:15</option>
            <option value="1000">10:00</option>
            <option value="1030">10:30</option>
            <option value="1115">11:15</option>
            <option value="1200">12:00</option>
            <option value="1245">12:45</option>
            <option value="1330">1:30</option>
            <option value="1415">2:15</option>
            <option value="1500">3:00</option>
        </select>
        <br>

        <label for="materia">Materia:</label>
        <select id="materia" required>
            <!-- Se llenará dinámicamente -->
        </select>
        <br>

        <button type="submit">Guardar</button>
    </form>
</body>
</html>
