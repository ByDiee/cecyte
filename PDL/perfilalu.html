<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Alumno</title>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js"></script>
</head>
<body>
    <h1>Perfil del Alumno</h1>
    <form id="studentProfileForm">
        <label for="firstName">Nombre:</label>
        <input type="text" id="firstName" name="firstName" required><br><br>

        <label for="lastNameP">Apellido Paterno:</label>
        <input type="text" id="lastNameP" name="lastNameP" required><br><br>

        <label for="lastNameM">Apellido Materno:</label>
        <input type="text" id="lastNameM" name="lastNameM" required><br><br>

        <label for="semester">Semestre:</label>
        <select id="semester" name="semester" required>
            <option value="">Seleccionar Semestre</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
        </select><br><br>

        <label for="group">Grupo:</label>
        <select id="group" name="group" required>
            <option value="">Seleccionar Grupo</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
        </select><br><br>

        <label for="career">Carrera:</label>
        <input type="text" id="career" name="career" readonly><br><br>

        <label for="enrollment">Matrícula:</label>
        <input type="text" id="enrollment" name="enrollment" required><br><br>

        <button type="submit">Guardar</button>
    </form>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAH6MvrHYih49lF9RY1mdi0L3JK9HFyIP0",
            authDomain: "pdlista-61c4d.firebaseapp.com",
            projectId: "pdlista-61c4d",
            storageBucket: "pdlista-61c4d.appspot.com",
            messagingSenderId: "449596760167",
            appId: "1:449596760167:web:dd667445d003c22f47f4c2",
            measurementId: "G-BDXFNR25C0",
            databaseURL: "https://pdlista-61c4d-default-rtdb.firebaseio.com/"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Referencias a los elementos del formulario
        const semesterSelect = document.getElementById('semester');
        const groupSelect = document.getElementById('group');
        const careerInput = document.getElementById('career');

        // Función para actualizar la carrera basada en el semestre y grupo
        function updateCareer() {
            const semester = semesterSelect.value;
            const group = groupSelect.value;

            if (semester && group) {
                const careerRef = firebase.database().ref(`classSchedules/${semester}/${group}`);
                careerRef.once('value').then((snapshot) => {
                    const career = snapshot.val();
                    careerInput.value = career ? career : 'Carrera no asignada';
                });
            } else {
                careerInput.value = '';
            }
        }

        // Escuchar cambios en el semestre y grupo para actualizar la carrera
        semesterSelect.addEventListener('change', updateCareer);
        groupSelect.addEventListener('change', updateCareer);

        // Función para guardar los datos del perfil en Firebase
        document.getElementById('studentProfileForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const userId = firebase.auth().currentUser.uid;
            const firstName = document.getElementById('firstName').value;
            const lastNameP = document.getElementById('lastNameP').value;
            const lastNameM = document.getElementById('lastNameM').value;
            const semester = document.getElementById('semester').value;
            const group = document.getElementById('group').value;
            const career = document.getElementById('career').value;
            const enrollment = document.getElementById('enrollment').value;

            firebase.database().ref(`users/${userId}`).set({
                firstName,
                lastNameP,
                lastNameM,
                semester,
                group,
                career,
                enrollment,
                role: "student",
                currentUserId: userId
            }).then(() => {
                alert('Perfil actualizado correctamente');
            }).catch((error) => {
                console.error('Error al actualizar el perfil:', error);
            });
        });
    </script>
</body>
</html>
